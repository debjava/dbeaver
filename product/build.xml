<project name="dbeaver" default="build">
	<!--sets the path of the properties file-->
	<property file="build.properties" />
	<property name="pdeBuildPluginVersion" value="3.6.0.v20100603"/>
	<property name="equinoxLauncherPluginVersion" value="1.1.0.v20100507"/>

	<target name="clean">
		<delete dir="${buildDirectory}" />
	</target>

	<target name="init">
		<mkdir dir="${buildDirectory}" />
		<mkdir dir="${buildDirectory}/plugins" />
		<mkdir dir="${buildDirectory}/features" />
		<copy todir="${buildDirectory}/plugins">
			<fileset dir="../plugins">
				<include name="**" />
			</fileset>
		</copy>
	</target>


	<!--
		This target actually executes the PDE Build process by launching the 
		Eclipse antRunner application.
	-->
	<target name="pde-build">
		<java classname="org.eclipse.equinox.launcher.Main" fork="true" failonerror="true">
			<arg value="-application" />
			<arg value="org.eclipse.ant.core.antRunner" />
			<arg value="-buildfile" />
			<arg value="${baseLocation}/plugins/org.eclipse.pde.build_${pdeBuildPluginVersion}/scripts/productBuild/productBuild.xml" />
			<arg value="-Dtimestamp=${timestamp}" />
			<classpath>
				<pathelement location="${baseLocation}/plugins/org.eclipse.equinox.launcher_${equinoxLauncherPluginVersion}.jar" />
			</classpath>
		</java>
	</target>

	<!--This target is responsible for cleaning up the build-directory
	<target name="clean">
		<delete dir="${buildDirectory}" />
	</target>-->

	<!--This target defines the run-order of the targets-->
	<target name="build" depends="init, pde-build" />

	<target name="installer">
		<mkdir dir="${buildDirectory}/installer" />
		<mkdir dir="${buildDirectory}/installer/raw" />
		<unzip 
			src="${buildDirectory}/${buildType}.${buildId}/${buildId}-win32.win32.x86.zip"
			dest="${buildDirectory}/installer/raw/win32.x86"
			overwrite="true"
			/>
		<filter filtersfile="build.properties"/>
		<copy todir="${buildDirectory}/installer" filtering="true">
			<fileset dir="installer">
				<include name="*.ns*" />
			</fileset>
		</copy>

		<exec executable="${nsisDirectory}\makensis" dir="${buildDirectory}/installer">
			<arg value="DBeaver.nsi"/>
		</exec>

		<delete dir="${buildDirectory}/installer" />
	</target>

</project>
